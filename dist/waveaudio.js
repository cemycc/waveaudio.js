module.exports=function(t){function e(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,a){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=8)}([function(t,e,i){"use strict";var a=i(5),n=function(){function t(t,e){this.properties=t,e&&this.validateProperties()}return t.prototype.validateProperties=function(){if("string"==typeof this.properties.wrapper){if(this.properties.wrapper=document.querySelector(this.properties.wrapper),!this.properties.wrapper)throw new Error("No wrapper element was found")}else if(!(this.properties.wrapper instanceof HTMLElement))throw new Error("Invalid wrapper element");if("string"!=typeof this.properties.audioFiles&&!(this.properties.audioFiles instanceof Array))throw new Error("Invalid data for audio files");this.properties.audioFiles=[].concat(this.properties.audioFiles)},t.prototype.setProperties=function(t){for(var e in this.properties)t.hasOwnProperty(e)&&this.properties.hasOwnProperty(e)&&(t[e]=this.properties[e])},t.prototype.getProperties=function(){return this.properties},t.prototype.getDiff=function(t,e){return t.filter(function(t){return e.indexOf(t)<0})},t.prototype.getColorAt=function(t){return this.properties.colors instanceof Array&&this.properties.colors[t]?this.properties.colors[t]:a({luminosity:"light"})},t}();e.BaseClass=n},function(t,e,i){"use strict";var a=function(){function t(e,i,a,n,s,r){void 0===n&&(n=0),void 0===s&&(s=null),void 0===r&&(r=1),this.name=e,this.type=i,this.defaultValue=a,this.type===t.List?this.items=n:this.min=n,this.max=s,this.step=r}return t}();a.Boolean="boolean",a.Integer="integer",a.Float="float",a.List="list",e.Property=a;var n=function(){function t(){}return t}();n.list={Filter:{properties:[new a("frequency",a.Integer,440,20,22050,1),new a("Q",a.Integer,1,.001,100,.001),new a("gain",a.Integer,0,-40,40,1),new a("filterType",a.List,"lowpass",["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"])],description:""},Gain:{properties:[new a("gain",a.Float,.7,0,30,.1)],description:""},Panner:{properties:[new a("pan",a.Float,0,-1,1,.1)],description:""},Tremolo:{properties:[new a("intensity",a.Float,.3,0,1,.01),new a("rate",a.Float,4,.001,8,.001),new a("stereoPhase",a.Integer,0,0,180,1),new a("bypass",a.Boolean,0)],description:""},Chorus:{properties:[new a("rate",a.Float,1.5,.01,8,.01),new a("delay",a.Float,.0045,0,1,1e-4),new a("feedback",a.Float,.45,0,.8,.01),new a("bypass",a.Boolean,0)],description:""},Phaser:{properties:[new a("rate",a.Float,1.2,.01,8,.01),new a("depth",a.Float,.3,0,1,.01),new a("feedback",a.Float,.2,0,.8,.01),new a("stereoPhase",a.Float,30,0,180,1),new a("baseModulationFrequency",a.Integer,700,500,1500,1),new a("bypass",a.Boolean,0)],description:""},Overdrive:{properties:[new a("outputGain",a.Float,.5,0,1,.01),new a("drive",a.Float,.7,0,1,.01),new a("curveAmount",a.Float,.8,0,1,.01),new a("algorithmIndex",a.Integer,0,0,5,1),new a("bypass",a.Boolean,0)],description:""},Delay:{properties:[new a("delayTime",a.Integer,150,1,1e4),new a("wetLevel",a.Float,.25,0,1,.01),new a("dryLevel",a.Float,1,0,1,.01),new a("cutoff",a.Integer,2e3,20,22050),new a("feedback",a.Float,.45,0,.8,.01),new a("bypass",a.Boolean,0)],description:""},Compressor:{properties:[new a("threshold",a.Integer,-1,-100,0,1),new a("makeupGain",a.Integer,1,0,5,1),new a("attack",a.Integer,1,0,1e3,1),new a("release",a.Integer,0,0,3e3,1),new a("ratio",a.Integer,4,1,20,1),new a("knee",a.Integer,5,0,40,1),new a("automakeup",a.Boolean,1),new a("bypass",a.Boolean,0)],description:""},Bitcrusher:{properties:[new a("bits",a.Integer,4,1,16,1),new a("normfreq",a.Float,.1,0,1,.1)],description:""},MoogFilter:{properties:[new a("cutoff",a.Float,.065,0,1,.001),new a("resonance",a.Float,3.5,0,4,.1)],description:""}},e.Effects=n},function(t,e,i){"use strict";var a=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},n=i(0),s=i(6),r=function(t){function e(e,i){var a=t.call(this,i)||this;return a.sourceFiles=[],a.filesPositions=[],a.onDecodedBuffers=new s.EventDispatcher,t.prototype.setProperties.call(a,a),a.activeChannel=e,a.ctx=new window.AudioContext,a.audioContextLoad=Date.now(),a}return a(e,t),e.prototype.addFiles=function(t){var e=this;Promise.all(t.map(function(t){return t.promise})).then(function(i){e.loadAudioFilesBuffers(i,t)}).catch(function(t){console.error(t)})},e.prototype.removeFiles=function(t,e){void 0===e&&(e=!0);for(var i=function(t){var e=a.sourceFiles.find(function(e){return e.url===t});a.sourceFiles.splice(a.sourceFiles.indexOf(e),1)},a=this,n=0,s=t;n<s.length;n++){var r=s[n];i(r)}this.assignBuffer(this.createAudioBuffer(this.sourceFiles),!0,!0,e)},e.prototype.extractBufferAt=function(t,e){return this.originalBuffer.slice(t,e)},e.prototype.applyBufferChanges=function(t){for(var e=this.buffer.getChannelData(this.activeChannel),i=0,a=t;i<a.length;i++){var n=a[i];n.idx+n.outputBuffer.length>e.length?e.set(n.outputBuffer.slice(0,e.length-n.idx),n.idx):e.set(n.outputBuffer,n.idx)}this.assignBuffer(this.createAudioBuffer(this.sourceFiles,[e]),!1,!1,!0)},e.prototype.revertBufferChanges=function(){var t=this.originalBuffer.slice();this.assignBuffer(this.createAudioBuffer(this.sourceFiles,[t]),!1,!1,!0)},e.prototype.playSound=function(t,e){void 0===t&&(t=0),this.playAudioSource=this.ctx.createBufferSource(),this.playAudioSource.buffer=this.buffer,this.playAudioSource.connect(this.ctx.destination),e&&(this.playAudioSource.onended=function(){return e()}),this.audioContextPlay=(Date.now()-this.audioContextLoad)/1e3-t,this.playAudioSource.start(0,t)},e.prototype.stopSound=function(){this.playAudioSource&&(this.playAudioSource.onended&&this.playAudioSource.onended(),this.playAudioSource.stop())},Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.ctx.currentTime-this.audioContextPlay},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"decodedBuffers",{get:function(){return this.onDecodedBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fileNames",{get:function(){return this.sourceFiles.map(function(t){return t.url})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positons",{get:function(){return this.filesPositions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sampleRate",{get:function(){return this.ctx.sampleRate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.buffer.duration},enumerable:!0,configurable:!0}),e.prototype.findFileIndex=function(t){return this.sourceFiles.indexOf(t)},e.prototype.loadAudioFilesBuffers=function(t,e){var i=this,a=t.map(function(t){return i.ctx.decodeAudioData(t)});Promise.all(a).then(function(t){var a=t.map(function(t,i){var a=e[i];return a.buffer=t,a});i.sourceFiles=i.sourceFiles.concat(a),i.assignBuffer(i.createAudioBuffer(i.sourceFiles))}).catch(function(t){console.error(t)})},e.prototype.findFilesPositionsOnBuffer=function(){this.filesPositions=[];for(var t=0,e=0,i=this.sourceFiles;e<i.length;e++){var a=i[e],n=this.activeChannel>a.buffer.numberOfChannels-1?0:this.activeChannel,s=t;this.filesPositions.push(s),t+=a.buffer.getChannelData(n).length}},e.prototype.createAudioBuffer=function(t,e){void 0===e&&(e=[]);for(var i=0,a=0,n=0,s=t;n<s.length;n++){var r=s[n],o=r.buffer;o.numberOfChannels>i&&(i=o.numberOfChannels),a+=o.duration}if(0===i)return this.ctx.createBuffer(1,this.ctx.sampleRate,this.ctx.sampleRate);var u=this.ctx.createBuffer(i,this.ctx.sampleRate*a,this.ctx.sampleRate),l=0,h=function(){var i=[];t.forEach(function(t){var e=t.buffer;l<=e.numberOfChannels-1?i.push(e.getChannelData(l)):i.push(new Float32Array(e.getChannelData(0).length))}),e[l]&&"[object Float32Array]"===Object.prototype.toString.call(e[l])?u.copyToChannel(e[l],l,0):u.copyToChannel(c.concatBuffersData(i),l,0)},c=this;do h();while(++l<i);return u},e.prototype.assignBuffer=function(t,e,i,a){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===a&&(a=!0),this.stopSound(),this.buffer=t,e&&(this.originalBuffer=this.buffer.getChannelData(this.activeChannel).slice()),i&&this.findFilesPositionsOnBuffer(),a&&this.onDecodedBuffers.trigger(this.buffer)},e.prototype.concatBuffersData=function(t){for(var e=t.reduce(function(t,e){return t+e.length},0),i=0,a=new Float32Array(e),n=0,s=t;n<s.length;n++){var r=s[n];a.set(r,i),i+=r.length}return a},e}(n.BaseClass);e.AudioBufferContext=r},function(t,e,i){"use strict";var a=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},n=i(0),s=function(t){function e(e){var i=t.call(this,e)||this;i.framesColor="rgb(208, 215, 220)",i.framesElapsedColor="rgb(47,79,79)",i.framesWidthBar=5,i.framesWidthSpacer=2,i.timelineHeight=40,i.timelineFont="11px Arial",i.timelineTimeColor="rgb(47,79,79)",i.timelineBarColor="rgb(128,128,128)",i.barHeight=12,i.barWidth=1,i.barLargeGroupCount=10,i.barSmallGroupCount=5,i.wrapper=void 0,t.prototype.setProperties.call(i,i),i.staticEl=document.createElement("canvas"),i.staticCtx=i.staticEl.getContext("2d"),i.framesEl=document.createElement("canvas"),i.framesEl.style.position="absolute",i.framesEl.style.top="0",i.framesEl.style.left="0",i.framesCtx=i.framesEl.getContext("2d");var a=i.staticCtx.webkitBackingStorePixelRatio||i.staticCtx.mozBackingStorePixelRatio||i.staticCtx.msBackingStorePixelRatio||i.staticCtx.oBackingStorePixelRatio||i.staticCtx.backingStorePixelRatio||1;return i.ratio=window.devicePixelRatio/a,i.resize(),i.wrapper.appendChild(i.staticEl),i.wrapper.appendChild(i.framesEl),i}return a(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this.staticEl.width/this.ratio},set:function(t){for(var e=0,i=["staticEl","framesEl"];e<i.length;e++){var a=i[e];this[a].width=t*this.ratio,this[a].style.width=t+"px"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.staticEl.height/this.ratio},set:function(t){for(var e=0,i=["staticEl","framesEl"];e<i.length;e++){var a=i[e];this[a].height=t*this.ratio,this[a].style.height=t+"px"}},enumerable:!0,configurable:!0}),e.prototype.resize=function(){this.width=this.wrapper.offsetWidth,this.height=this.wrapper.offsetHeight,this.staticCtx.scale(this.ratio,this.ratio),this.framesCtx.scale(this.ratio,this.ratio)},e.prototype.loadAudioData=function(t,e,i,a,n,s){this.audioProgress=n,this.audioCompletedStatus=s,this.audioDuration=e,this.audioFiles=i,this.computeValues(t,a),this.clear()},e.prototype.draw=function(){var t=this;this.computeRenderData(function(e,i,a){t.staticCtx.fillStyle=t.audioFiles.length?t.audioFiles[a].color:t.framesColor,t.staticCtx.fillRect(e.x,e.y,e.width,e.height)}),this.drawTimeline(this.audioDuration)},e.prototype.startRenderingProgress=function(){var t=this,e=function(){t.drawFrames(t.audioProgress()),t.audioCompletedStatus()?t.stopRenderingProgress():t.rafId=requestAnimationFrame(e)};this.rafId=requestAnimationFrame(e)},e.prototype.stopRenderingProgress=function(){this.rafId&&(this.framesCtx.clearRect(0,0,this.width,this.height),cancelAnimationFrame(this.rafId))},e.prototype.drawFrames=function(t){this.clear(!0);for(var e=0,i=this.renderRectData;e<i.length;e++){var a=i[e];if(this.framesCtx.fillStyle=this.framesElapsedColor,this.framesCtx.fillRect(a.x,a.y,a.width,a.height),a.x>t)break}},e.prototype.computeRenderData=function(t){this.renderRectData=new Array;for(var e=0,i=0,a=this.audioData;i<a.length;i++){var n=a[i],s=isNaN(n[0])?0:n[0],r=n[1],o=e*this.framesWidthBar,u=this.height/2-this.timelineHeight/2-s,l=this.height/2-this.timelineHeight/2+s,h=this.framesWidthBar-this.framesWidthSpacer,c={x:o,y:u,width:h,height:l-u>0?l-u:h};this.renderRectData.push(c),"function"==typeof t&&t(c,e,r),e++}},e.prototype.computeValues=function(t,e){var i=Math.floor(this.width/this.framesWidthBar),a=t.length/i;this.audioData=new Array(i);for(var n=0,s=0,r=0;r<this.audioData.length;r++){for(var o=0,u=0;u<a;u++)t[n]&&(o+=Math.abs(t[n])),n++;var l=e.length?e.indexOf(e.reduce(function(t,e){return t<=n&&e>n?t:e})):0;this.audioData[r]=[o/a,l],this.audioData[r][0]>s&&(s=this.audioData[r][0])}s=32768/s;for(var r=0;r<this.audioData.length;r++)this.audioData[r][0]*=s,this.audioData[r][0]=this.audioData[r][0]/32768*((this.height-this.timelineHeight)/2)},e.prototype.drawTimeline=function(t){var e=this,i=Math.ceil(t),a=this.width/i,n=a/this.barSmallGroupCount,s=Math.floor(this.timelineHeight/2),r=function(t,i){var a,n=e.toHHMMSS(t),r=e.staticCtx.measureText(n).width,o=parseInt(e.staticCtx.font,10);a=0===i?0:i===e.width?i-r:i-r/2,e.staticCtx.fillStyle=e.timelineTimeColor,e.staticCtx.fillText(n,a,e.height-s+o)};this.staticCtx.font=this.timelineFont;for(var o=0;o<=i;o++){var u=this.barHeight,l=a*o;o%this.barLargeGroupCount!==0&&o!==i||(u+=this.barHeight/2,r(o,l));var h=0===l?0:l-1;this.staticCtx.fillStyle=this.timelineBarColor,this.staticCtx.fillRect(h,this.height-s-u,this.barWidth,u);for(var c=1;c<this.barSmallGroupCount;c++)u=this.barHeight/2,this.staticCtx.fillRect(h+c*n,this.height-s-u,this.barWidth,u)}},e.prototype.clear=function(t){t||this.staticCtx.clearRect(0,0,this.width,this.height),this.framesCtx.clearRect(0,0,this.width,this.height)},e.prototype.toHHMMSS=function(t){var e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),a=t-3600*e-60*i;return e<10&&(e="0"+e.toString()),i<10&&(i="0"+i.toString()),a<10&&(a="0"+a.toString()),"00"===e?i+":"+a:e+":"+i+":"+a},e}(n.BaseClass);e.CanvasContext=s},function(t,e,i){"use strict";var a=i(1),n=i(7),s=function(){function t(t,e){var i=this;this.effects=[],this.totalLoadedFiles=0,this.audioCtx=e,this.audioCtx.decodedBuffers.on(function(t){i.totalLoadedFiles!==i.audioCtx.sourceFiles.length&&i.sync(),i.totalLoadedFiles=i.audioCtx.sourceFiles.length})}return t.prototype.get=function(){return this.effects},t.prototype.add=function(t,e,i){for(var n={},s=0,r=a.Effects.list[t].properties;s<r.length;s++){var o=r[s];n[o.name]=o.defaultValue}return this.effects.push({effect:t,properties:n,indexStart:e,indexEnd:i,seconds:this.calculateSeconds(e,i)}),!0},t.prototype.apply=function(){var t=this.getSecondsInterval();this.applyEffectPerSecond(t[0],t[1])},t.prototype.remove=function(t,e){return void 0===e&&(e=!0),this.effects.splice(this.effects.indexOf(t),1),e&&this.effects.length>0&&this.apply(),e&&0===this.effects.length&&this.audioCtx.revertBufferChanges(),!0},t.prototype.sync=function(){for(var t=this.effects.length;t--;){var e=this.effects[t];this.remove(e,!1)}},t.prototype.calculateSeconds=function(t,e){for(var i=t/this.audioCtx.sampleRate,a=[],n=i;n<e/this.audioCtx.sampleRate;n++)a.push(n);return a},t.prototype.getSecondsInterval=function(){if(!this.effects.length)return[0,0];for(var t=this.effects[0].indexStart,e=this.effects[0].indexEnd,i=0,a=this.effects;i<a.length;i++){var n=a[i];n.indexStart<t&&(t=n.indexStart),n.indexEnd>e&&(e=n.indexEnd)}return[t,e]},t.prototype.applyEffectPerSecond=function(t,e){var i=this,a=[],s=0,r=new Promise(function(t){return t()});t=Math.floor(t/this.audioCtx.sampleRate),e=Math.ceil(e/this.audioCtx.sampleRate);for(var o=function(t){var e=new OfflineAudioContext(1,u.audioCtx.sampleRate,u.audioCtx.sampleRate),i=new n(e),o={idx:u.audioCtx.sampleRate*t,effectsList:u.effectsForSecond(t,i),inputBuffer:u.audioCtx.extractBufferAt(u.audioCtx.sampleRate*t,u.audioCtx.sampleRate*(t+1)),outputBuffer:null};if(!o.effectsList.length)return"continue";a.push(o);var l=e.createBuffer(1,o.inputBuffer.length,u.audioCtx.sampleRate);l.copyToChannel(o.inputBuffer,0,0);var h=e.createBufferSource();h.buffer=l,h.connect(o.effectsList[0].input),o.effectsList[o.effectsList.length-1].connect(e.destination),h.start(0),r=r.then(function(t){return t&&(a[s].outputBuffer=t.getChannelData(0),s++),e.startRendering()})},u=this,l=t;l<e;l++)o(l);r.then(function(t){return t&&(a[a.length-1].outputBuffer=t.getChannelData(0)),i.audioCtx.applyBufferChanges(a)})},t.prototype.effectsForSecond=function(t,e){for(var i=[],a=0,n=0,s=this.effects;n<s.length;n++){var r=s[n];if(r.seconds.indexOf(t)!==-1){var o=new e[r.effect](r.properties);a>0&&i[a-1].connect(o.input),i.push(o),a++}}return i},t}();e.EffectsStore=s},function(t,e,i){var a,n,s;!function(i,r){n=[],a=r,s="function"==typeof a?a.apply(e,n):a,!(void 0!==s&&(t.exports=s))}(this,function(){function t(t){var e=s(t.hue),i=u(e);return i<0&&(i=360+i),i}function e(t,e){if("random"===e.luminosity)return u([0,100]);if("monochrome"===e.hue)return 0;var i=r(t),a=i[0],n=i[1];switch(e.luminosity){case"bright":a=55;break;case"dark":a=n-10;break;case"light":n=55}return u([a,n])}function i(t,e,i){var a=n(t,e),s=100;switch(i.luminosity){case"dark":s=a+20;break;case"light":a=(s+a)/2;break;case"random":a=0,s=100}return u([a,s])}function a(t,e){switch(e.format){case"hsvArray":return t;case"hslArray":return p(t);case"hsl":var i=p(t);return"hsl("+i[0]+", "+i[1]+"%, "+i[2]+"%)";case"hsla":var a=p(t);return"hsla("+a[0]+", "+a[1]+"%, "+a[2]+"%, "+Math.random()+")";case"rgbArray":return f(t);case"rgb":var n=f(t);return"rgb("+n.join(", ")+")";case"rgba":var s=f(t);return"rgba("+s.join(", ")+", "+Math.random()+")";default:return l(t)}}function n(t,e){for(var i=o(t).lowerBounds,a=0;a<i.length-1;a++){var n=i[a][0],s=i[a][1],r=i[a+1][0],u=i[a+1][1];if(e>=n&&e<=r){var l=(u-s)/(r-n),h=s-l*n;return l*e+h}}return 0}function s(t){if("number"==typeof parseInt(t)){var e=parseInt(t);if(e<360&&e>0)return[e,e]}if("string"==typeof t&&m[t]){var i=m[t];if(i.hueRange)return i.hueRange}return[0,360]}function r(t){return o(t).saturationRange}function o(t){t>=334&&t<=360&&(t-=360);for(var e in m){var i=m[e];if(i.hueRange&&t>=i.hueRange[0]&&t<=i.hueRange[1])return m[e]}return"Color not found"}function u(t){if(null===v)return Math.floor(t[0]+Math.random()*(t[1]+1-t[0]));var e=t[1]||1,i=t[0]||0;v=(9301*v+49297)%233280;var a=v/233280;return Math.floor(i+a*(e-i))}function l(t){function e(t){var e=t.toString(16);return 1==e.length?"0"+e:e}var i=f(t),a="#"+e(i[0])+e(i[1])+e(i[2]);return a}function h(t,e,i){var a=i[0][0],n=i[i.length-1][0],s=i[i.length-1][1],r=i[0][1];m[t]={hueRange:e,lowerBounds:i,saturationRange:[a,n],brightnessRange:[s,r]}}function c(){h("monochrome",null,[[0,0],[100,0]]),h("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),h("orange",[19,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),h("yellow",[47,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),h("green",[63,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),h("blue",[179,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),h("purple",[258,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),h("pink",[283,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function f(t){var e=t[0];0===e&&(e=1),360===e&&(e=359),e/=360;var i=t[1]/100,a=t[2]/100,n=Math.floor(6*e),s=6*e-n,r=a*(1-i),o=a*(1-s*i),u=a*(1-(1-s)*i),l=256,h=256,c=256;switch(n){case 0:l=a,h=u,c=r;break;case 1:l=o,h=a,c=r;break;case 2:l=r,h=a,c=u;break;case 3:l=r,h=o,c=a;break;case 4:l=u,h=r,c=a;break;case 5:l=a,h=r,c=o}var f=[Math.floor(255*l),Math.floor(255*h),Math.floor(255*c)];return f}function p(t){var e=t[0],i=t[1]/100,a=t[2]/100,n=(2-i)*a;return[e,Math.round(i*a/(n<1?n:2-n)*1e4)/100,n/2*100]}function d(t){for(var e=0,i=0;i!==t.length&&!(e>=Number.MAX_SAFE_INTEGER);i++)e+=t.charCodeAt(i);return e}var v=null,m={};c();var y=function(n){if(n=n||{},n.seed&&n.seed===parseInt(n.seed,10))v=n.seed;else if("string"==typeof n.seed)v=d(n.seed);else{if(void 0!==n.seed&&null!==n.seed)throw new TypeError("The seed value must be an integer or string");v=null}var s,r,o;if(null!==n.count&&void 0!==n.count){var u=n.count,l=[];for(n.count=null;u>l.length;)v&&n.seed&&(n.seed+=1),l.push(y(n));return n.count=u,l}return s=t(n),r=e(s,n),o=i(s,r,n),a([s,r,o],n)};return y})},function(t,e,i){"use strict";var a=function(){function t(){this.handlers=[]}return t.prototype.on=function(t){this.handlers.push(t)},t.prototype.off=function(t){this.handlers=this.handlers.filter(function(e){return e!==t})},t.prototype.trigger=function(t){this.handlers.slice(0).forEach(function(e){return e(t)})},t}();e.EventDispatcher=a},function(t,e,i){!function(){function e(){return i}function i(t){if(!(this instanceof i))return new i(t);var e="undefined"==typeof window?{}:window;if(e.AudioContext||(e.AudioContext=e.webkitAudioContext),t||(console.log("tuna.js: Missing audio context! Creating a new context for you."),t=e.AudioContext&&new e.AudioContext),!t)throw new Error("Tuna cannot initialize because this environment does not support web audio.");a(t),l=t,h=this}function a(t){function e(){var t=arguments[0];return arguments[0]=f.isPrototypeOf?f.isPrototypeOf(t)?t.input:t:t.input||t,n.apply(this,arguments),t}if(t.__connectified__!==!0){var i=t.createGain(),a=Object.getPrototypeOf(Object.getPrototypeOf(i)),n=a.connect;a.connect=e,t.__connectified__=!0}}function n(t){return Math.max(0,Math.round(100*Math.pow(2,t/6))/100)}function s(t,e){var i,a,n=0,s=0,r=0,o=0;return i=t.toExponential().match(/^.\.?(.*)e(.+)$/),n=parseInt(i[2],10)-(i[1]+"").length,i=e.toExponential().match(/^.\.?(.*)e(.+)$/),s=parseInt(i[2],10)-(i[1]+"").length,s>n&&(n=s),a=t%e,n<-100||n>20?(r=Math.round(Math.log(a)/Math.log(10)),o=Math.pow(10,r),(a/o).toFixed(r-n)*o):parseFloat(a.toFixed(-n))}function r(t){return 0===t?1:Math.abs(t)/t}function o(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function u(t,e){return void 0===t?e:t}var l,h,c=function(t,e){t.value=e},f=Object.create(null,{activate:{writable:!0,value:function(t){t?(this.input.disconnect(),this.input.connect(this.activateNode),this.activateCallback&&this.activateCallback(t)):(this.input.disconnect(),this.input.connect(this.output))}},bypass:{get:function(){return this._bypass},set:function(t){this._lastBypassValue!==t&&(this._bypass=t,this.activate(!t),this._lastBypassValue=t)}},connect:{value:function(t){this.output.connect(t)}},disconnect:{value:function(t){this.output.disconnect(t)}},connectInOrder:{value:function(t){for(var e=t.length-1;e--;){if(!t[e].connect)return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",t[e]);t[e+1].input?t[e].connect(t[e+1].input):t[e].connect(t[e+1])}}},getDefaults:{value:function(){var t={};for(var e in this.defaults)t[e]=this.defaults[e].value;return t}},automate:{value:function(t,e,i,a){var n,s=a?~~(a/1e3):l.currentTime,r=i?~~(i/1e3):0,o=this.defaults[t],u=this[t];u?o.automatable?(i?(n="linearRampToValueAtTime",u.cancelScheduledValues(s),u.setValueAtTime(u.value,s)):n="setValueAtTime",u[n](e,r+s)):u=e:console.error("Invalid Property for "+this.name)}}}),p="float",d="boolean",v="string",m="int";"undefined"!=typeof t&&t.exports?t.exports=i:window.define("Tuna",e),i.prototype.Bitcrusher=function(t){t||(t=this.getDefaults()),this.bufferSize=t.bufferSize||this.defaults.bufferSize.value,this.input=l.createGain(),this.activateNode=l.createGain(),this.processor=l.createScriptProcessor(this.bufferSize,1,1),this.output=l.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var e,i,a,n,s,r=0,o=0;this.processor.onaudioprocess=function(t){for(e=t.inputBuffer.getChannelData(0),i=t.outputBuffer.getChannelData(0),a=Math.pow(.5,this.bits),s=e.length,n=0;n<s;n++)r+=this.normfreq,r>=1&&(r-=1,o=a*Math.floor(e[n]/a+.5)),i[n]=o},this.bits=t.bits||this.defaults.bits.value,this.normfreq=u(t.normfreq,this.defaults.normfreq.value),this.bypass=t.bypass||!1},i.prototype.Bitcrusher.prototype=Object.create(f,{name:{value:"Bitcrusher"},defaults:{writable:!0,value:{bits:{value:4,min:1,max:16,automatable:!1,type:m},bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:m},bypass:{value:!1,automatable:!1,type:d},normfreq:{value:.1,min:1e-4,max:1,automatable:!1,type:p}}},bits:{enumerable:!0,get:function(){return this.processor.bits},set:function(t){this.processor.bits=t}},normfreq:{enumerable:!0,get:function(){return this.processor.normfreq},set:function(t){this.processor.normfreq=t}}}),i.prototype.Cabinet=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.convolver=this.newConvolver(t.impulsePath||"../impulses/impulse_guitar.wav"),this.makeupNode=l.createGain(),this.output=l.createGain(),this.activateNode.connect(this.convolver.input),this.convolver.output.connect(this.makeupNode),this.makeupNode.connect(this.output),this.makeupGain=u(t.makeupGain,this.defaults.makeupGain),this.bypass=t.bypass||!1},i.prototype.Cabinet.prototype=Object.create(f,{name:{value:"Cabinet"},defaults:{writable:!0,value:{makeupGain:{value:1,min:0,max:20,automatable:!0,type:p},bypass:{value:!1,automatable:!1,type:d}}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){this.makeupNode.gain.value=t}},newConvolver:{value:function(t){return new h.Convolver({impulse:t,dryLevel:0,wetLevel:1})}}}),i.prototype.Chorus=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.attenuator=this.activateNode=l.createGain(),this.splitter=l.createChannelSplitter(2),this.delayL=l.createDelay(),this.delayR=l.createDelay(),this.feedbackGainNodeLR=l.createGain(),this.feedbackGainNodeRL=l.createGain(),this.merger=l.createChannelMerger(2),this.output=l.createGain(),this.lfoL=new h.LFO({target:this.delayL.delayTime,callback:c}),this.lfoR=new h.LFO({target:this.delayR.delayTime,callback:c}),this.input.connect(this.attenuator),this.attenuator.connect(this.output),this.attenuator.connect(this.splitter),this.splitter.connect(this.delayL,0),this.splitter.connect(this.delayR,1),this.delayL.connect(this.feedbackGainNodeLR),this.delayR.connect(this.feedbackGainNodeRL),this.feedbackGainNodeLR.connect(this.delayR),this.feedbackGainNodeRL.connect(this.delayL),this.delayL.connect(this.merger,0,0),this.delayR.connect(this.merger,0,1),this.merger.connect(this.output),this.feedback=u(t.feedback,this.defaults.feedback.value),this.rate=u(t.rate,this.defaults.rate.value),this.delay=u(t.delay,this.defaults.delay.value),this.depth=u(t.depth,this.defaults.depth.value),this.lfoR.phase=Math.PI/2,this.attenuator.gain.value=.6934,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},i.prototype.Chorus.prototype=Object.create(f,{name:{value:"Chorus"},defaults:{writable:!0,value:{feedback:{value:.4,min:0,max:.95,automatable:!1,type:p},delay:{value:.0045,min:0,max:1,automatable:!1,type:p},depth:{value:.7,min:0,max:1,automatable:!1,type:p},rate:{value:1.5,min:0,max:8,automatable:!1,type:p},bypass:{value:!1,automatable:!1,type:d}}},delay:{enumerable:!0,get:function(){return this._delay},set:function(t){this._delay=2e-4*(2*Math.pow(10,t)),this.lfoL.offset=this._delay,this.lfoR.offset=this._delay,this._depth=this._depth}},depth:{enumerable:!0,get:function(){return this._depth},set:function(t){this._depth=t,this.lfoL.oscillation=this._depth*this._delay,this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:!0,get:function(){return this._feedback},set:function(t){this._feedback=t,this.feedbackGainNodeLR.gain.value=this._feedback,this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:!0,get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}}}),i.prototype.Compressor=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.compNode=this.activateNode=l.createDynamicsCompressor(),this.makeupNode=l.createGain(),this.output=l.createGain(),this.compNode.connect(this.makeupNode),this.makeupNode.connect(this.output),this.automakeup=u(t.automakeup,this.defaults.automakeup.value),this.makeupGain=u(t.makeupGain,this.defaults.makeupGain.value),this.threshold=u(t.threshold,this.defaults.threshold.value),this.release=u(t.release,this.defaults.release.value),this.attack=u(t.attack,this.defaults.attack.value),this.ratio=t.ratio||this.defaults.ratio.value,this.knee=u(t.knee,this.defaults.knee.value),this.bypass=t.bypass||!1},i.prototype.Compressor.prototype=Object.create(f,{name:{value:"Compressor"},defaults:{writable:!0,value:{threshold:{value:-20,min:-60,max:0,automatable:!0,type:p},release:{value:250,min:10,max:2e3,automatable:!0,type:p},makeupGain:{value:1,min:1,max:100,automatable:!0,type:p},attack:{value:1,min:0,max:1e3,automatable:!0,type:p},ratio:{value:4,min:1,max:50,automatable:!0,type:p},knee:{value:5,min:0,max:40,automatable:!0,type:p},automakeup:{value:!1,automatable:!1,type:d},bypass:{value:!1,automatable:!1,type:d}}},computeMakeup:{value:function(){var t=4,e=this.compNode;return-(e.threshold.value-e.threshold.value/e.ratio.value)/t}},automakeup:{enumerable:!0,get:function(){return this._automakeup},set:function(t){this._automakeup=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},threshold:{enumerable:!0,get:function(){return this.compNode.threshold},set:function(t){this.compNode.threshold.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},ratio:{enumerable:!0,get:function(){return this.compNode.ratio},set:function(t){this.compNode.ratio.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},knee:{enumerable:!0,get:function(){return this.compNode.knee},set:function(t){this.compNode.knee.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},attack:{enumerable:!0,get:function(){return this.compNode.attack},set:function(t){this.compNode.attack.value=t/1e3}},release:{enumerable:!0,get:function(){return this.compNode.release},set:function(t){this.compNode.release.value=t/1e3}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){this.makeupNode.gain.value=n(t)}}}),i.prototype.Convolver=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.convolver=l.createConvolver(),this.dry=l.createGain(),this.filterLow=l.createBiquadFilter(),this.filterHigh=l.createBiquadFilter(),this.wet=l.createGain(),this.output=l.createGain(),this.activateNode.connect(this.filterLow),this.activateNode.connect(this.dry),this.filterLow.connect(this.filterHigh),this.filterHigh.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.dryLevel=u(t.dryLevel,this.defaults.dryLevel.value),this.wetLevel=u(t.wetLevel,this.defaults.wetLevel.value),this.highCut=t.highCut||this.defaults.highCut.value,this.buffer=t.impulse||"../impulses/ir_rev_short.wav",this.lowCut=t.lowCut||this.defaults.lowCut.value,this.level=u(t.level,this.defaults.level.value),this.filterHigh.type="lowpass",this.filterLow.type="highpass",this.bypass=t.bypass||!1},i.prototype.Convolver.prototype=Object.create(f,{name:{value:"Convolver"},defaults:{writable:!0,value:{highCut:{value:22050,min:20,max:22050,automatable:!0,type:p},lowCut:{value:20,min:20,max:22050,automatable:!0,type:p},dryLevel:{value:1,min:0,max:1,automatable:!0,type:p},wetLevel:{value:1,min:0,max:1,automatable:!0,type:p},level:{value:1,min:0,max:1,automatable:!0,type:p}}},lowCut:{get:function(){return this.filterLow.frequency},set:function(t){this.filterLow.frequency.value=t}},highCut:{get:function(){return this.filterHigh.frequency},set:function(t){this.filterHigh.frequency.value=t}},level:{get:function(){return this.output.gain},set:function(t){this.output.gain.value=t}},dryLevel:{get:function(){return this.dry.gain},set:function(t){this.dry.gain.value=t}},wetLevel:{get:function(){return this.wet.gain},set:function(t){this.wet.gain.value=t}},buffer:{enumerable:!1,get:function(){return this.convolver.buffer;
},set:function(t){var e=this.convolver,i=new XMLHttpRequest;return t?(i.open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(i.status<300&&i.status>199||302===i.status)&&l.decodeAudioData(i.response,function(t){e.buffer=t},function(t){t&&console.log("Tuna.Convolver.setBuffer: Error decoding data"+t)})},void i.send(null)):void console.log("Tuna.Convolver.setBuffer: Missing impulse path!")}}}),i.prototype.Delay=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.dry=l.createGain(),this.wet=l.createGain(),this.filter=l.createBiquadFilter(),this.delay=l.createDelay(10),this.feedbackNode=l.createGain(),this.output=l.createGain(),this.activateNode.connect(this.delay),this.activateNode.connect(this.dry),this.delay.connect(this.filter),this.filter.connect(this.feedbackNode),this.feedbackNode.connect(this.delay),this.feedbackNode.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.delayTime=t.delayTime||this.defaults.delayTime.value,this.feedback=u(t.feedback,this.defaults.feedback.value),this.wetLevel=u(t.wetLevel,this.defaults.wetLevel.value),this.dryLevel=u(t.dryLevel,this.defaults.dryLevel.value),this.cutoff=t.cutoff||this.defaults.cutoff.value,this.filter.type="lowpass",this.bypass=t.bypass||!1},i.prototype.Delay.prototype=Object.create(f,{name:{value:"Delay"},defaults:{writable:!0,value:{delayTime:{value:100,min:20,max:1e3,automatable:!1,type:p},feedback:{value:.45,min:0,max:.9,automatable:!0,type:p},cutoff:{value:2e4,min:20,max:2e4,automatable:!0,type:p},wetLevel:{value:.5,min:0,max:1,automatable:!0,type:p},dryLevel:{value:1,min:0,max:1,automatable:!0,type:p}}},delayTime:{enumerable:!0,get:function(){return this.delay.delayTime},set:function(t){this.delay.delayTime.value=t/1e3}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(t){this.wet.gain.value=t}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(t){this.dry.gain.value=t}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(t){this.feedbackNode.gain.value=t}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(t){this.filter.frequency.value=t}}}),i.prototype.Filter=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.filter=l.createBiquadFilter(),this.output=l.createGain(),this.activateNode.connect(this.filter),this.filter.connect(this.output),this.frequency=t.frequency||this.defaults.frequency.value,this.Q=t.resonance||this.defaults.Q.value,this.filterType=u(t.filterType,this.defaults.filterType.value),this.gain=u(t.gain,this.defaults.gain.value),this.bypass=t.bypass||!1},i.prototype.Filter.prototype=Object.create(f,{name:{value:"Filter"},defaults:{writable:!0,value:{frequency:{value:800,min:20,max:22050,automatable:!0,type:p},Q:{value:1,min:.001,max:100,automatable:!0,type:p},gain:{value:0,min:-40,max:40,automatable:!0,type:p},bypass:{value:!1,automatable:!1,type:d},filterType:{value:"lowpass",automatable:!1,type:v}}},filterType:{enumerable:!0,get:function(){return this.filter.type},set:function(t){this.filter.type=t}},Q:{enumerable:!0,get:function(){return this.filter.Q},set:function(t){this.filter.Q.value=t}},gain:{enumerable:!0,get:function(){return this.filter.gain},set:function(t){this.filter.gain.value=t}},frequency:{enumerable:!0,get:function(){return this.filter.frequency},set:function(t){this.filter.frequency.value=t}}}),i.prototype.Gain=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.gainNode=l.createGain(),this.output=l.createGain(),this.activateNode.connect(this.gainNode),this.gainNode.connect(this.output),this.gain=u(t.gain,this.defaults.gain.value),this.bypass=t.bypass||!1},i.prototype.Gain.prototype=Object.create(f,{name:{value:"Gain"},defaults:{writable:!0,value:{bypass:{value:!1,automatable:!1,type:d},gain:{value:1,automatable:!0,type:p}}},gain:{enumerable:!0,get:function(){return this.gainNode.gain},set:function(t){this.gainNode.gain.value=t}}}),i.prototype.MoogFilter=function(t){t||(t=this.getDefaults()),this.bufferSize=t.bufferSize||this.defaults.bufferSize.value,this.input=l.createGain(),this.activateNode=l.createGain(),this.processor=l.createScriptProcessor(this.bufferSize,1,1),this.output=l.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var e,i,a,n,s,r,o,h;e=i=a=n=s=r=o=h=0;var c,f,p,d,v,m,y;this.processor.onaudioprocess=function(t){for(c=t.inputBuffer.getChannelData(0),f=t.outputBuffer.getChannelData(0),p=1.16*this.cutoff,y=.35013*(p*p)*(p*p),d=this.resonance*(1-.15*p*p),m=c.length,v=0;v<m;v++)c[v]-=h*d,c[v]*=y,s=c[v]+.3*e+(1-p)*s,e=c[v],r=s+.3*i+(1-p)*r,i=s,o=r+.3*a+(1-p)*o,a=r,h=o+.3*n+(1-p)*h,n=o,f[v]=h},this.cutoff=u(t.cutoff,this.defaults.cutoff.value),this.resonance=u(t.resonance,this.defaults.resonance.value),this.bypass=t.bypass||!1},i.prototype.MoogFilter.prototype=Object.create(f,{name:{value:"MoogFilter"},defaults:{writable:!0,value:{bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:m},bypass:{value:!1,automatable:!1,type:d},cutoff:{value:.065,min:1e-4,max:1,automatable:!1,type:p},resonance:{value:3.5,min:0,max:4,automatable:!1,type:p}}},cutoff:{enumerable:!0,get:function(){return this.processor.cutoff},set:function(t){this.processor.cutoff=t}},resonance:{enumerable:!0,get:function(){return this.processor.resonance},set:function(t){this.processor.resonance=t}}}),i.prototype.Overdrive=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.inputDrive=l.createGain(),this.waveshaper=l.createWaveShaper(),this.outputDrive=l.createGain(),this.output=l.createGain(),this.activateNode.connect(this.inputDrive),this.inputDrive.connect(this.waveshaper),this.waveshaper.connect(this.outputDrive),this.outputDrive.connect(this.output),this.ws_table=new Float32Array(this.k_nSamples),this.drive=u(t.drive,this.defaults.drive.value),this.outputGain=u(t.outputGain,this.defaults.outputGain.value),this.curveAmount=u(t.curveAmount,this.defaults.curveAmount.value),this.algorithmIndex=u(t.algorithmIndex,this.defaults.algorithmIndex.value),this.bypass=t.bypass||!1},i.prototype.Overdrive.prototype=Object.create(f,{name:{value:"Overdrive"},defaults:{writable:!0,value:{drive:{value:1,min:0,max:1,automatable:!0,type:p,scaled:!0},outputGain:{value:1,min:0,max:1,automatable:!0,type:p,scaled:!0},curveAmount:{value:.725,min:0,max:1,automatable:!1,type:p},algorithmIndex:{value:0,min:0,max:5,automatable:!1,type:m}}},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(t){this._drive=t}},curveAmount:{get:function(){return this._curveAmount},set:function(t){this._curveAmount=t,void 0===this._algorithmIndex&&(this._algorithmIndex=0),this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table),this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(t){this._outputGain=n(t)}},algorithmIndex:{get:function(){return this._algorithmIndex},set:function(t){this._algorithmIndex=t,this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(t,e,i){t=Math.min(t,.9999);var a,n,s=2*t/(1-t);for(a=0;a<e;a++)n=2*a/e-1,i[a]=(1+s)*n/(1+s*Math.abs(n))},function(t,e,i){var a,n,s;for(a=0;a<e;a++)n=2*a/e-1,s=(.5*Math.pow(n+1.4,2)-1)*s>=0?5.8:1.2,i[a]=o(s)},function(t,e,i){var a,n,s,r=1-t;for(a=0;a<e;a++)n=2*a/e-1,s=n<0?-Math.pow(Math.abs(n),r+.04):Math.pow(n,r),i[a]=o(2*s)},function(t,e,i){var a,n,s,o,u=1-t>.99?.99:1-t;for(a=0;a<e;a++)n=2*a/e-1,o=Math.abs(n),o<u?s=o:o>u?s=u+(o-u)/(1+Math.pow((o-u)/(1-u),2)):o>1&&(s=o),i[a]=r(n)*s*(1/((u+1)/2))},function(t,e,i){var a,n;for(a=0;a<e;a++)n=2*a/e-1,n<-.08905?i[a]=-.75*(1-Math.pow(1-(Math.abs(n)-.032857),12)+1/3*(Math.abs(n)-.032847))+.01:n>=-.08905&&n<.320018?i[a]=-6.153*(n*n)+3.9375*n:i[a]=.630035},function(t,e,i){var a,n,s=2+Math.round(14*t),r=Math.round(Math.pow(2,s-1));for(a=0;a<e;a++)n=2*a/e-1,i[a]=Math.round(n*r)/r}]}}),i.prototype.Panner=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.panner=l.createStereoPanner(),this.output=l.createGain(),this.activateNode.connect(this.panner),this.panner.connect(this.output),this.pan=u(t.pan,this.defaults.pan.value),this.bypass=t.bypass||!1},i.prototype.Panner.prototype=Object.create(f,{name:{value:"Panner"},defaults:{writable:!0,value:{bypass:{value:!1,automatable:!1,type:d},pan:{value:0,min:-1,max:1,automatable:!0,type:p}}},pan:{enumerable:!0,get:function(){return this.panner.pan},set:function(t){this.panner.pan.value=t}}}),i.prototype.Phaser=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.splitter=this.activateNode=l.createChannelSplitter(2),this.filtersL=[],this.filtersR=[],this.feedbackGainNodeL=l.createGain(),this.feedbackGainNodeR=l.createGain(),this.merger=l.createChannelMerger(2),this.filteredSignal=l.createGain(),this.output=l.createGain(),this.lfoL=new h.LFO({target:this.filtersL,callback:this.callback}),this.lfoR=new h.LFO({target:this.filtersR,callback:this.callback});for(var e=this.stage;e--;)this.filtersL[e]=l.createBiquadFilter(),this.filtersR[e]=l.createBiquadFilter(),this.filtersL[e].type="allpass",this.filtersR[e].type="allpass";this.input.connect(this.splitter),this.input.connect(this.output),this.splitter.connect(this.filtersL[0],0,0),this.splitter.connect(this.filtersR[0],1,0),this.connectInOrder(this.filtersL),this.connectInOrder(this.filtersR),this.filtersL[this.stage-1].connect(this.feedbackGainNodeL),this.filtersL[this.stage-1].connect(this.merger,0,0),this.filtersR[this.stage-1].connect(this.feedbackGainNodeR),this.filtersR[this.stage-1].connect(this.merger,0,1),this.feedbackGainNodeL.connect(this.filtersL[0]),this.feedbackGainNodeR.connect(this.filtersR[0]),this.merger.connect(this.output),this.rate=u(t.rate,this.defaults.rate.value),this.baseModulationFrequency=t.baseModulationFrequency||this.defaults.baseModulationFrequency.value,this.depth=u(t.depth,this.defaults.depth.value),this.feedback=u(t.feedback,this.defaults.feedback.value),this.stereoPhase=u(t.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},i.prototype.Phaser.prototype=Object.create(f,{name:{value:"Phaser"},stage:{value:4},defaults:{writable:!0,value:{rate:{value:.1,min:0,max:8,automatable:!1,type:p},depth:{value:.6,min:0,max:1,automatable:!1,type:p},feedback:{value:.7,min:0,max:1,automatable:!1,type:p},stereoPhase:{value:40,min:0,max:180,automatable:!1,type:p},baseModulationFrequency:{value:700,min:500,max:1500,automatable:!1,type:p}}},callback:{value:function(t,e){for(var i=0;i<4;i++)t[i].frequency.value=e}},depth:{get:function(){return this._depth},set:function(t){this._depth=t,this.lfoL.oscillation=this._baseModulationFrequency*this._depth,this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:!0,get:function(){return this._baseModulationFrequency},set:function(t){this._baseModulationFrequency=t,this.lfoL.offset=this._baseModulationFrequency,this.lfoR.offset=this._baseModulationFrequency,this._depth=this._depth}},feedback:{get:function(){return this._feedback},set:function(t){this._feedback=t,this.feedbackGainNodeL.gain.value=this._feedback,this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(t){this._stereoPhase=t;var e=this.lfoL._phase+this._stereoPhase*Math.PI/180;e=s(e,2*Math.PI),this.lfoR._phase=e}}}),i.prototype.PingPongDelay=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.wetLevel=l.createGain(),this.stereoToMonoMix=l.createGain(),this.feedbackLevel=l.createGain(),this.output=l.createGain(),this.delayLeft=l.createDelay(10),this.delayRight=l.createDelay(10),this.activateNode=l.createGain(),this.splitter=l.createChannelSplitter(2),this.merger=l.createChannelMerger(2),this.activateNode.connect(this.splitter),this.splitter.connect(this.stereoToMonoMix,0,0),this.splitter.connect(this.stereoToMonoMix,1,0),this.stereoToMonoMix.gain.value=.5,this.stereoToMonoMix.connect(this.wetLevel),this.wetLevel.connect(this.delayLeft),this.feedbackLevel.connect(this.delayLeft),this.delayLeft.connect(this.delayRight),this.delayRight.connect(this.feedbackLevel),this.delayLeft.connect(this.merger,0,0),this.delayRight.connect(this.merger,0,1),this.merger.connect(this.output),this.activateNode.connect(this.output),this.delayTimeLeft=void 0!==t.delayTimeLeft?t.delayTimeLeft:this.defaults.delayTimeLeft.value,this.delayTimeRight=void 0!==t.delayTimeRight?t.delayTimeRight:this.defaults.delayTimeRight.value,this.feedbackLevel.gain.value=void 0!==t.feedback?t.feedback:this.defaults.feedback.value,this.wetLevel.gain.value=void 0!==t.wetLevel?t.wetLevel:this.defaults.wetLevel.value,this.bypass=t.bypass||!1},i.prototype.PingPongDelay.prototype=Object.create(f,{name:{value:"PingPongDelay"},delayTimeLeft:{enumerable:!0,get:function(){return this._delayTimeLeft},set:function(t){this._delayTimeLeft=t,this.delayLeft.delayTime.value=t/1e3}},delayTimeRight:{enumerable:!0,get:function(){return this._delayTimeRight},set:function(t){this._delayTimeRight=t,this.delayRight.delayTime.value=t/1e3}},defaults:{writable:!0,value:{delayTimeLeft:{value:200,min:1,max:1e4,automatable:!1,type:m},delayTimeRight:{value:400,min:1,max:1e4,automatable:!1,type:m},feedback:{value:.3,min:0,max:1,automatable:!1,type:p},wetLevel:{value:.5,min:0,max:1,automatable:!1,type:p}}}}),i.prototype.Tremolo=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.splitter=this.activateNode=l.createChannelSplitter(2),this.amplitudeL=l.createGain(),this.amplitudeR=l.createGain(),this.merger=l.createChannelMerger(2),this.output=l.createGain(),this.lfoL=new h.LFO({target:this.amplitudeL.gain,callback:c}),this.lfoR=new h.LFO({target:this.amplitudeR.gain,callback:c}),this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0),this.splitter.connect(this.amplitudeR,1),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output),this.rate=t.rate||this.defaults.rate.value,this.intensity=u(t.intensity,this.defaults.intensity.value),this.stereoPhase=u(t.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.offset=1-this.intensity/2,this.lfoR.offset=1-this.intensity/2,this.lfoL.phase=this.stereoPhase*Math.PI/180,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},i.prototype.Tremolo.prototype=Object.create(f,{name:{value:"Tremolo"},defaults:{writable:!0,value:{intensity:{value:.3,min:0,max:1,automatable:!1,type:p},stereoPhase:{value:0,min:0,max:180,automatable:!1,type:p},rate:{value:5,min:.1,max:11,automatable:!1,type:p}}},intensity:{enumerable:!0,get:function(){return this._intensity},set:function(t){this._intensity=t,this.lfoL.offset=1-this._intensity/2,this.lfoR.offset=1-this._intensity/2,this.lfoL.oscillation=this._intensity,this.lfoR.oscillation=this._intensity}},rate:{enumerable:!0,get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},stereoPhase:{enumerable:!0,get:function(){return this._stereoPhase},set:function(t){this._stereoPhase=t;var e=this.lfoL._phase+this._stereoPhase*Math.PI/180;e=s(e,2*Math.PI),this.lfoR.phase=e}}}),i.prototype.WahWah=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.envelopeFollower=new h.EnvelopeFollower({target:this,callback:function(t,e){t.sweep=e}}),this.filterBp=l.createBiquadFilter(),this.filterPeaking=l.createBiquadFilter(),this.output=l.createGain(),this.activateNode.connect(this.filterBp),this.filterBp.connect(this.filterPeaking),this.filterPeaking.connect(this.output),this.init(),this.automode=u(t.automode,this.defaults.automode.value),this.resonance=t.resonance||this.defaults.resonance.value,this.sensitivity=u(t.sensitivity,this.defaults.sensitivity.value),this.baseFrequency=u(t.baseFrequency,this.defaults.baseFrequency.value),this.excursionOctaves=t.excursionOctaves||this.defaults.excursionOctaves.value,this.sweep=u(t.sweep,this.defaults.sweep.value),this.activateNode.gain.value=2,this.envelopeFollower.activate(!0),this.bypass=t.bypass||!1},i.prototype.WahWah.prototype=Object.create(f,{name:{value:"WahWah"},defaults:{writable:!0,value:{automode:{value:!0,automatable:!1,type:d},baseFrequency:{value:.5,min:0,max:1,automatable:!1,type:p},excursionOctaves:{value:2,min:1,max:6,automatable:!1,type:p},sweep:{value:.2,min:0,max:1,automatable:!1,type:p},resonance:{value:10,min:1,max:100,automatable:!1,type:p},sensitivity:{value:.5,min:-1,max:1,automatable:!1,type:p}}},automode:{get:function(){return this._automode},set:function(t){this._automode=t,t?(this.activateNode.connect(this.envelopeFollower.input),this.envelopeFollower.activate(!0)):(this.envelopeFollower.activate(!1),this.activateNode.disconnect(),this.activateNode.connect(this.filterBp))}},filterFreqTimeout:{value:0},setFilterFreq:{value:function(){try{this.filterBp.frequency.value=Math.min(22050,this._baseFrequency+this._excursionFrequency*this._sweep),this.filterPeaking.frequency.value=Math.min(22050,this._baseFrequency+this._excursionFrequency*this._sweep)}catch(t){clearTimeout(this.filterFreqTimeout),this.filterFreqTimeout=setTimeout(function(){this.setFilterFreq()}.bind(this),0)}}},sweep:{enumerable:!0,get:function(){return this._sweep},set:function(t){this._sweep=Math.pow(t>1?1:t<0?0:t,this._sensitivity),this.setFilterFreq()}},baseFrequency:{enumerable:!0,get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=50*Math.pow(10,2*t),this._excursionFrequency=Math.min(l.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},excursionOctaves:{enumerable:!0,get:function(){return this._excursionOctaves},set:function(t){this._excursionOctaves=t,this._excursionFrequency=Math.min(l.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},sensitivity:{enumerable:!0,get:function(){return this._sensitivity},set:function(t){this._sensitivity=Math.pow(10,t)}},resonance:{enumerable:!0,get:function(){return this._resonance},set:function(t){this._resonance=t,this.filterPeaking.Q=this._resonance}},init:{value:function(){this.output.gain.value=1,this.filterPeaking.type="peaking",this.filterBp.type="bandpass",this.filterPeaking.frequency.value=100,this.filterPeaking.gain.value=20,this.filterPeaking.Q.value=5,this.filterBp.frequency.value=100,this.filterBp.Q.value=1}}}),i.prototype.EnvelopeFollower=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.jsNode=this.output=l.createScriptProcessor(this.buffersize,1,1),this.input.connect(this.output),this.attackTime=u(t.attackTime,this.defaults.attackTime.value),this.releaseTime=u(t.releaseTime,this.defaults.releaseTime.value),this._envelope=0,this.target=t.target||{},this.callback=t.callback||function(){},this.bypass=t.bypass||!1},i.prototype.EnvelopeFollower.prototype=Object.create(f,{name:{value:"EnvelopeFollower"},defaults:{value:{attackTime:{value:.003,min:0,max:.5,automatable:!1,type:p},releaseTime:{value:.5,min:0,max:.5,automatable:!1,type:p}}},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:!0,get:function(){return this._attackTime},set:function(t){this._attackTime=t,this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:!0,get:function(){return this._releaseTime},set:function(t){this._releaseTime=t,this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(t){"function"==typeof t?this._callback=t:console.error("tuna.js: "+this.name+": Callback must be a function!")}},target:{get:function(){return this._target},set:function(t){this._target=t}},activate:{value:function(t){this.activated=t,t?(this.jsNode.connect(l.destination),this.jsNode.onaudioprocess=this.returnCompute(this)):(this.jsNode.disconnect(),this.jsNode.onaudioprocess=null),this.activateCallback&&this.activateCallback(t)}},returnCompute:{value:function(t){return function(e){t.compute(e)}}},compute:{value:function(t){var e,i,a,n,s=t.inputBuffer.getChannelData(0).length,r=t.inputBuffer.numberOfChannels;if(i=a=n=0,r>1)for(n=0;n<s;++n)for(;i<r;++i)e=t.inputBuffer.getChannelData(i)[n],a+=e*e/r;else for(n=0;n<s;++n)e=t.inputBuffer.getChannelData(0)[n],a+=e*e;a=Math.sqrt(a),this._envelope<a?(this._envelope*=this._attackC,this._envelope+=(1-this._attackC)*a):(this._envelope*=this._releaseC,this._envelope+=(1-this._releaseC)*a),this._callback(this._target,this._envelope)}}}),i.prototype.LFO=function(t){t||(t=this.getDefaults()),this.input=l.createGain(),this.output=l.createScriptProcessor(256,1,1),this.activateNode=l.destination,this.frequency=u(t.frequency,this.defaults.frequency.value),this.offset=u(t.offset,this.defaults.offset.value),this.oscillation=u(t.oscillation,this.defaults.oscillation.value),this.phase=u(t.phase,this.defaults.phase.value),this.target=t.target||{},this.output.onaudioprocess=this.callback(t.callback||function(){}),this.bypass=t.bypass||!1},i.prototype.LFO.prototype=Object.create(f,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},defaults:{value:{frequency:{value:1,min:0,max:20,automatable:!1,type:p},offset:{value:.85,min:0,max:22049,automatable:!1,type:p},oscillation:{value:.3,min:-22050,max:22050,automatable:!1,type:p},phase:{value:0,min:0,max:2*Math.PI,automatable:!1,type:p}}},frequency:{get:function(){return this._frequency},set:function(t){this._frequency=t,this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(t){this._offset=t}},oscillation:{get:function(){return this._oscillation},set:function(t){this._oscillation=t}},phase:{get:function(){return this._phase},set:function(t){this._phase=t}},target:{get:function(){return this._target},set:function(t){this._target=t}},activate:{value:function(t){t?(this.output.connect(l.destination),this.activateCallback&&this.activateCallback(t)):this.output.disconnect()}},callback:{value:function(t){var e=this;return function(){e._phase+=e._phaseInc,e._phase>2*Math.PI&&(e._phase=0),t(e._target,e._offset+e._oscillation*Math.sin(e._phase))}}}}),i.toString=i.prototype.toString=function(){return"Please visit https://github.com/Theodeus/tuna/wiki for instructions on how to use Tuna.js"}}()},function(t,e,i){"use strict";var a=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},n=i(0),s=i(2),r=i(3),o=i(1),u=i(4),l=0,h=function(t){function e(e){var i=t.call(this,e,!0)||this;return i.canvasCtx=new r.CanvasContext(t.prototype.getProperties.call(i)),i.audioCtx=new s.AudioBufferContext(l,t.prototype.getProperties.call(i)),i.effectsStore=new u.EffectsStore(l,i.audioCtx),i.audioCtx.decodedBuffers.on(function(t){return i.render(t)}),i.addFiles(t.prototype.getProperties.call(i).audioFiles),i}return a(e,t),e.prototype.files=function(t){var e=this.getDiff(this.audioCtx.fileNames,t),i=this.getDiff(t,this.audioCtx.fileNames);e.length&&this.audioCtx.removeFiles(e,!(i.length>0)),i.length&&this.addFiles(i)},Object.defineProperty(e.prototype,"loadedFiles",{get:function(){return this.audioCtx.sourceFiles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effects",{get:function(){return this.effectsStore.get()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effectsList",{get:function(){return o.Effects.list},enumerable:!0,configurable:!0}),e.prototype.addEffect=function(t,e,i){return this.effectsStore.add(t,e,i)},e.prototype.removeEffect=function(t){return this.effectsStore.remove(t)},e.prototype.applyEffect=function(t){return this.effectsStore.apply()},e.prototype.playAudio=function(t,e){var i=this;void 0===t&&(t=0),this.canvasCtx.startRenderingProgress();var a=function(){i.canvasCtx.stopRenderingProgress(),e&&e()};return this.audioCtx.playSound(t,a)},e.prototype.stopAudio=function(){return this.canvasCtx.stopRenderingProgress(),this.audioCtx.stopSound()},Object.defineProperty(e.prototype,"duration",{get:function(){return this.audioCtx.duration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sampleRate",{get:function(){return this.audioCtx.sampleRate},enumerable:!0,configurable:!0}),e.prototype.getLengthAt=function(t){var e=this.audioCtx.sourceFiles.find(function(e){return e.url==t}),i=this.audioCtx.sourceFiles.indexOf(e);return this.audioCtx.sourceFiles.reduce(function(t,e,a){return a<i?t+e.buffer.duration:t},0)},e.prototype.getAudioFileDuration=function(t){var e=this.audioCtx.sourceFiles.find(function(e){return e.url==t});return e?e.buffer.duration:0},e.prototype.render=function(t){var e=this;this.canvasCtx.loadAudioData(t.getChannelData(l),t.duration,this.audioCtx.sourceFiles,this.audioCtx.positons,function(){return e.audioCtx.currentTime/t.duration*e.canvasCtx.width},function(){return e.audioCtx.currentTime>t.duration}),this.canvasCtx.draw()},e.prototype.addFiles=function(t){var e=this,i=t.map(function(t,i){return e.sendRequest(t,i)});this.audioCtx.addFiles(i)},e.prototype.sendRequest=function(e,i){var a=new Promise(function(t,i){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=function(){t(a.response)},a.onerror=function(){i("Invalid audio file "+e)},a.send()});return{url:e,promise:a,color:t.prototype.getColorAt.call(this,i)}},e}(n.BaseClass);e.WaveAudioJS=h}]);